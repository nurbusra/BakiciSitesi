<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:jsf="http://xmlns.jcp.org/jsf" 
      template="/template/enhancedTemplate.xhtml">

    <ui:define name="content">
        <h2>Hesabım</h2> 
        <br> </br > 
        İsim: #{sessionBean.entity.isim} <br/>
        E-posta: #{sessionBean.entity.email} <br/>
        Rol: #{sessionBean.entity.sinif} <br/>
        <div jsf:rendered="#{sessionBean.entity.sinif == 0}">su_id: #{sessionBean.childSu.su_id}</div><br/>
        <div jsf:rendered="#{sessionBean.entity.sinif == 1}">bakici_id: #{sessionBean.childBakici.bakici_id}</div><br/>
        <div jsf:rendered="#{sessionBean.entity.sinif == 2}">musteri_id: #{sessionBean.childMusteri.musteri_id}</div><br/>
        
        <h:form id="buttons">
            <h:commandButton styleClass="button btn-sm btn-danger" 
                             action="/ilanolustur.xhtml?faces-redirect=true" 
                             rendered="#{sessionBean.entity.sinif == 1}" 
                             value="İlan Oluştur"/> <br/><br/>
        </h:form>
        
        <!-- Conditionally rendered <div>. See: 
        https://stackoverflow.com/questions/8816212/how-to-conditionally-render-plain-html-elements-like-divs
        -->
        
        <h:panelGroup id="customPanel">
            <div jsf:rendered="#{sessionBean.entity.sinif == 1}"><!-- Bakıcı Paneli-->
                <h4>İlanlarım</h4> 
                <h:form id="tableBakici">       
                    <h:dataTable styleClass="table table-striped" value="#{sessionBean.childBakici.ilanlarList}" var="i">

                        <h:column> 
                            <f:facet name="header">ID</f:facet>
                                #{i.ilan_id}
                        </h:column>
                        <h:column> 
                            <f:facet name="header">Açıklama</f:facet>
                                #{i.aciklama}
                        </h:column>
                        <h:column> 
                            <f:facet name="header">Ücret</f:facet>
                                #{i.ucret}
                        </h:column>
                        <h:column> 
                            <f:facet name="header">Aktiflik</f:facet>
                                #{i.aktif}
                        </h:column>
                        <h:column> 
                            <f:facet name="header">Bakıcı ID</f:facet>
                                #{i.bakici_id}
                        </h:column>
                        <h:column>
                            <f:facet name="header">Action</f:facet>
                            <h:commandButton styleClass="btn btn-danger" value="Detay" action="/ilan.xhtml">
                                <f:actionListener binding="#{ilanBean.setEntity(i)}" />
                            </h:commandButton>
                        </h:column>

                    </h:dataTable>           
                </h:form>  
            </div>
            
            <div jsf:rendered="#{sessionBean.entity.sinif == 2}"><!-- Müşteri Paneli-->
                <h4>Başvurularım</h4> 
                <h:form id="tableMusteri">       
                    <h:dataTable styleClass="table table-striped" value="#{sessionBean.childMusteri.basvuruList}" var="i">

                        <h:column> 
                            <f:facet name="header">ID</f:facet>
                                #{i.alisveris_id}
                        </h:column>
                        <h:column> 
                            <f:facet name="header">Ilan ID</f:facet>
                                #{i.ilan.ilan_id}
                        </h:column>
                        <h:column> 
                            <f:facet name="header">Tamamlandı</f:facet>
                                #{i.odendi}
                        </h:column>
                        <h:column>
                            <f:facet name="header">Action</f:facet>
                            <!--<h:commandButton styleClass="btn btn-danger" value="Detay" action="/ilan.xhtml">
                                <f:actionListener binding="#//{musterixilanBean.viewIlanDetail(i)}" />
                            </h:commandButton>-->
                            
                            <h:commandButton rendered="#{i.odendi==false}"
                                             styleClass="btn btn-danger" value="İptal"
                                             action="#{sessionBean.childMusteri.updateBasvuruList(sessionBean.childMusteri.musteri_id)}"
                                             >
                                <f:actionListener binding="#{musterixilanBean.setEntity(i)}" />
                                <f:actionListener binding="#{musterixilanBean.deleteEntity()}" />
                                <f:ajax execute="tableMusteri" render="tableMusteri"/>
                            </h:commandButton>
                        </h:column>

                    </h:dataTable>           
                </h:form>  
            </div>
        </h:panelGroup>
    </ui:define>    
</ui:composition>